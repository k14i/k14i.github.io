<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Brick Failure Detection &mdash; keithseahus.github.io 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../../static/doctools.js"></script>
    <link rel="top" title="keithseahus.github.io 1.0.0 documentation" href="../../../../index.html" />
    <link rel="up" title="GlusterFS 3.5の新機能" href="index.html" />
    <link rel="next" title="Disk encryption" href="disk_encryption.html" />
    <link rel="prev" title="zerofill" href="zerofill.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../../../static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="disk_encryption.html" title="Disk encryption"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="zerofill.html" title="zerofill"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../../index.html">keithseahus.github.io 1.0.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >GlusterFS</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">GlusterFS 3.5の新機能</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="brick-failure-detection">
<h1>Brick Failure Detection<a class="headerlink" href="#brick-failure-detection" title="Permalink to this headline">¶</a></h1>
<p>Detecting failures on the filesystem that a brick uses makes it possible to handle errors that are caused from outside of the Gluster environment.</p>
<div class="highlight-python"><pre>[2014-05-19 3:39:53]# brick="/mnt/lv4/vol4";gluster volume create vol4 eins:$brick zwei:$brick drei:$brick vier:$brick fuenf:$brick sechs:$brick
volume create: vol4: success: please start the volume to access data
[2014-05-19 3:40:22]# gluster volume start vol4
volume start: vol4: success

# gluster volume set vol4 storage.health-check-interval 10
volume set: success


[2014-05-19 3:51:16]# gluster volume info vol4

Volume Name: vol4
Type: Distribute
Volume ID: 706122a9-44fc-4d1d-8c3b-97482d98b95c
Status: Started
Number of Bricks: 6
Transport-type: tcp
Bricks:
Brick1: eins:/mnt/lv4/vol4
Brick2: zwei:/mnt/lv4/vol4
Brick3: drei:/mnt/lv4/vol4
Brick4: vier:/mnt/lv4/vol4
Brick5: fuenf:/mnt/lv4/vol4
Brick6: sechs:/mnt/lv4/vol4
Options Reconfigured:
storage.health-check-interval: 10


[sechs]# dmsetup table
vg0-swift: 0 209715200 linear 8:7 838862848
vg0-cinder: 0 209715200 linear 8:7 419432448
vg0-lv4: 0 209715200 linear 8:7 1468008448
vg0-lv3: 0 209715200 linear 8:7 1258293248
vg0-lv2: 0 209715200 linear 8:7 1048578048
vg0-lv1: 0 209715200 linear 8:7 209717248
vg0-lv0: 0 209715200 linear 8:7 2048
vg0-glance: 0 209715200 linear 8:7 629147648

# echo 0 209715200 error &gt; dmsetup-error-target


[2014-05-19 3:43:43]# dmsetup load vg0-lv4 dmsetup-error-target
[2014-05-19 3:44:46]# dmsetup resume vg0-lv4
[2014-05-19 3:45:06]# dmsetup table
vg0-swift: 0 209715200 linear 8:7 838862848
vg0-cinder: 0 209715200 linear 8:7 419432448
vg0-lv4: 0 209715200 error
vg0-lv3: 0 209715200 linear 8:7 1258293248
vg0-lv2: 0 209715200 linear 8:7 1048578048
vg0-lv1: 0 209715200 linear 8:7 209717248
vg0-lv0: 0 209715200 linear 8:7 2048
vg0-glance: 0 209715200 linear 8:7 629147648</pre>
</div>
<div class="section" id="brick">
<h2>brick<a class="headerlink" href="#brick" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[2014-05-18 18:49:53.720594] I [glusterfsd-mgmt.c:56:mgmt_cbk_spec] 0-mgmt: Volume file changed
[2014-05-18 18:50:04.238239] W [posix-helpers.c:1294:posix_health_check_thread_proc] 0-vol4-posix: stat() on /mnt/lv4/vol4 returned: Input/output error
[2014-05-18 18:50:04.238328] M [posix-helpers.c:1314:posix_health_check_thread_proc] 0-vol4-posix: health-check failed, going down

Message from syslogd@sechs at May 19 03:50:04 ...
 glusterfsd: [2014-05-18 18:50:04.238328] M [posix-helpers.c:1314:posix_health_check_thread_proc] 0-vol4-posix: health-check failed, going down


[2014-05-18 18:50:34.238551] M [posix-helpers.c:1319:posix_health_check_thread_proc] 0-vol4-posix: still alive! -&gt; SIGTERM

Message from syslogd@sechs at May 19 03:50:34 ...
 glusterfsd: [2014-05-18 18:50:34.238551] M [posix-helpers.c:1319:posix_health_check_thread_proc] 0-vol4-posix: still alive! -&gt; SIGTERM
[2014-05-18 18:50:34.238910] W [glusterfsd.c:1095:cleanup_and_exit] (--&gt;/lib64/libc.so.6(clone+0x6d) [0x7f1144ebab7d] (--&gt;/lib64/libpthread.so.0(+0x79d1) [0x7f114554d9d1] (--&gt;/usr/local/glusterfs-3.5.0/sbin/glusterfsd(glusterfs_sigwaiter+0xf0) [0x4085af]))) 0-: received signum (15), shutting down</pre>
</div>
</div>
<div class="section" id="syslog">
<h2>syslog<a class="headerlink" href="#syslog" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>May 19 03:49:55 sechs kernel: XFS (dm-7): metadata I/O error: block 0x0 ("xfs_buf_iodone_callbacks") error 5 buf count 4096
May 19 03:49:57 sechs kernel: XFS (dm-7): metadata I/O error: block 0x6400108 ("xlog_iodone") error 5 buf count 4096
May 19 03:49:57 sechs kernel: XFS (dm-7): xfs_do_force_shutdown(0x2) called from line 1062 of file fs/xfs/xfs_log.c.  Return address = 0xffffffffa04dd131
May 19 03:49:57 sechs kernel: XFS (dm-7): Log I/O Error Detected.  Shutting down filesystem
May 19 03:49:57 sechs kernel: XFS (dm-7): Please umount the filesystem and rectify the problem(s)
May 19 03:50:04 sechs glusterfsd: [2014-05-18 18:50:04.238328] M [posix-helpers.c:1314:posix_health_check_thread_proc] 0-vol4-posix: health-check failed, going down

Message from syslogd@sechs at May 19 03:50:04 ...
 glusterfsd: [2014-05-18 18:50:04.238328] M [posix-helpers.c:1314:posix_health_check_thread_proc] 0-vol4-posix: health-check failed, going down
May 19 03:50:27 sechs kernel: XFS (dm-7): xfs_log_force: error 5 returned.

Message from syslogd@sechs at May 19 03:50:34 ...
 glusterfsd: [2014-05-18 18:50:34.238551] M [posix-helpers.c:1319:posix_health_check_thread_proc] 0-vol4-posix: still alive! -&gt; SIGTERM
May 19 03:50:34 sechs glusterfsd: [2014-05-18 18:50:34.238551] M [posix-helpers.c:1319:posix_health_check_thread_proc] 0-vol4-posix: still alive! -&gt; SIGTERM
May 19 03:50:57 sechs kernel: XFS (dm-7): xfs_log_force: error 5 returned.</pre>
</div>
</div>
<div class="section" id="gluster-volume-status">
<h2>gluster volume status<a class="headerlink" href="#gluster-volume-status" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[2014-05-19 3:52:41]# gluster volume status vol4
Status of volume: vol4
Gluster process                                               Port    Online  Pid
------------------------------------------------------------------------------
Brick eins:/mnt/lv4/vol4                              49160   Y       2925
Brick zwei:/mnt/lv4/vol4                              49159   Y       440
Brick drei:/mnt/lv4/vol4                              49152   Y       32500
Brick vier:/mnt/lv4/vol4                              49152   Y       32657
Brick fuenf:/mnt/lv4/vol4                             49152   Y       24517
Brick sechs:/mnt/lv4/vol4                             N/A     N       N/A
NFS Server on localhost                                       2049    Y       29535
NFS Server on zwei                                    N/A     N       N/A
NFS Server on vier                                    N/A     N       N/A
NFS Server on drei                                    N/A     N       N/A
NFS Server on eins                                    N/A     N       N/A
NFS Server on fuenf                                   N/A     N       N/A
NFS Server on sechs                                   N/A     N       N/A

Task Status of Volume vol4
------------------------------------------------------------------------------
There are no active volume tasks</pre>
</div>
</div>
<div class="section" id="process">
<h2>process<a class="headerlink" href="#process" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ps -ef | grep glusterfsd | grep -v grep | wc -l</span>
<span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="service-glusterd-restart">
<h2>service glusterd restart<a class="headerlink" href="#service-glusterd-restart" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[2014-05-18 18:58:17.197872] I [glusterfsd.c:1959:main] 0-/usr/local/glusterfs-3.5.0/sbin/glusterfsd: Started running /usr/local/glusterfs-3.5.0/sbin/glusterfsd version 3.5git (/usr/local/glusterfs-3.5.0/sbin/glusterfsd -s sechs --volfile-id vol4.sechs.mnt-lv4-vol4 -p /var/lib/glusterd/vols/vol4/run/sechs-mnt-lv4-vol4.pid -S /var/run/23afc72b5ceddccd28b405b1cdf5b4df.socket --brick-name /mnt/lv4/vol4 -l /usr/local/glusterfs-3.5.0/var/log/glusterfs/bricks/mnt-lv4-vol4.log --xlator-option *-posix.glusterd-uuid=0765d288-a59b-4ccf-90ae-c3332c83dbf4 --brick-port 49152 --xlator-option vol4-server.listen-port=49152)
[2014-05-18 18:58:17.205310] I [socket.c:3561:socket_init] 0-socket.glusterfsd: SSL support is NOT enabled
[2014-05-18 18:58:17.205486] I [socket.c:3576:socket_init] 0-socket.glusterfsd: using system polling thread
[2014-05-18 18:58:17.205880] I [socket.c:3561:socket_init] 0-glusterfs: SSL support is NOT enabled
[2014-05-18 18:58:17.205949] I [socket.c:3576:socket_init] 0-glusterfs: using system polling thread
[2014-05-18 18:58:18.834910] I [graph.c:254:gf_add_cmdline_options] 0-vol4-server: adding option 'listen-port' for volume 'vol4-server' with value '49152'
[2014-05-18 18:58:18.834976] I [graph.c:254:gf_add_cmdline_options] 0-vol4-posix: adding option 'glusterd-uuid' for volume 'vol4-posix' with value '0765d288-a59b-4ccf-90ae-c3332c83dbf4'
[2014-05-18 18:58:18.837332] I [rpcsvc.c:2064:rpcsvc_set_outstanding_rpc_limit] 0-rpc-service: Configured rpc.outstanding-rpc-limit with value 64
[2014-05-18 18:58:18.837510] W [options.c:848:xl_opt_validate] 0-vol4-server: option 'listen-port' is deprecated, preferred is 'transport.socket.listen-port', continuing with correction
[2014-05-18 18:58:18.837572] I [socket.c:3561:socket_init] 0-tcp.vol4-server: SSL support is NOT enabled
[2014-05-18 18:58:18.837601] I [socket.c:3576:socket_init] 0-tcp.vol4-server: using system polling thread
[2014-05-18 18:58:18.838445] E [common-utils.c:93:mkdir_p] 0-: Failed due to reason Input/output error
[2014-05-18 18:58:18.838505] I [mem-pool.c:539:mem_pool_destroy] 0-vol4-changelog: size=108 max=0 total=0
[2014-05-18 18:58:18.838533] E [xlator.c:403:xlator_init] 0-vol4-changelog: Initialization of volume 'vol4-changelog' failed, review your volfile again
[2014-05-18 18:58:18.838561] E [graph.c:307:glusterfs_graph_init] 0-vol4-changelog: initializing translator failed
[2014-05-18 18:58:18.838610] E [graph.c:502:glusterfs_graph_activate] 0-graph: init failed
[2014-05-18 18:58:18.839480] W [glusterfsd.c:1095:cleanup_and_exit] (--&gt;/usr/local/glusterfs-3.5.0/lib/libgfrpc.so.0(rpc_clnt_handle_reply+0x1b5) [0x7f2981c837d8] (--&gt;/usr/local/glusterfs-3.5.0/sbin/glusterfsd(mgmt_getspec_cbk+0x36a) [0x40cf77] (--&gt;/usr/local/glusterfs-3.5.0/sbin/glusterfsd(glusterfs_process_volfp+0x18a) [0x408bf2]))) 0-: received signum (0), shutting down</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><div id="toc" class="sidebarRow">
  <h3><a href="https://github.com/keithseahus">My repository</a></h3>

  <h3><a href="../../../../index.html">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/elixir/index.html">Elixir</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/c/index.html">C</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">GlusterFS</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../data_science/bayesian_statistics/bayes_theorem/index.html">Bayes&#8217; theorem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data_science/personal_data_protection/index.html">Personal Data Protection</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../others/sphinx/index.html">Sphinx</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../reports/2014/erlang_factory_sf_bay_area_2014/index.html">Erlang Factory SF Bay Area 2014</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../media/twitter/timeline.html">Timeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../media/twitter/favorites.html">Favorite Tweets</a></li>
</ul>

  
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="zerofill.html"
                        title="previous chapter">zerofill</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="disk_encryption.html"
                        title="next chapter">Disk encryption</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../sources/technology/glusterfs/new_features/3.5/brick_failure_detection.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="disk_encryption.html" title="Disk encryption"
             >next</a> |</li>
        <li class="right" >
          <a href="zerofill.html" title="zerofill"
             >previous</a> |</li>
        <li><a href="../../../../index.html">keithseahus.github.io 1.0.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >GlusterFS</a> &raquo;</li>
          <li><a href="index.html" >GlusterFS 3.5の新機能</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Keisuke Takahashi.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>