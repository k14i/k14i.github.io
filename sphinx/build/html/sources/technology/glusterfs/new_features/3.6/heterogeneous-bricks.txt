--------------------
heterogeneous-bricks
--------------------

概要
----

DHTは、現状ではbrickのサイズについて非常にナイーブです。これは、各brickが実際には異なるサイズであるかもしれないにも関わらず、新しいファイルを配置するために、等量の"重み"を各brickやsubvolumeに割り当てるからです。
合計容量や空きスペースがより多いbrickに対しては、DHTはより大きな重み付け（例えばより多くのファイルを作成する）を行ったほうがよいでしょう。

詳細
----

（少なくとも）3つのオプションがあり得ます。

* 総容量をベースにsubvolumeに対して重み付けを行う
* 空き容量をベースにsubvolumeに対して重み付けを行う
* 特定のsubvolumeに対して全ての（又はほぼ全ての）重みを割り当てる

最後のオプションは、brickの追加によりvolumeを拡張する方で、古いデータをマイグレートさせることなく、新しいファイルを新しいbrickへ誘導することで、システムが「自動的なrebalance」を行うようにするようにしたい方にとって、便利です。
一旦適切な重みが計算されたら、rebalanceコマンドはその結果を再帰的にvolume内の全てのディレクトリ（カスタムレイアウトを除く）に対して適用し、DHTはこれと同じ重み付けに従って、新しいディレクトリに対してレイアウトを割り当てるべきでしょう。

GlusterFSへのベネフィット
-------------------------

（メーリングリストにも記した通り、）古いbrickと異なる新たなbrickを追加すること、それはディスクの容量が世代を経るに従って向上する傾向にあるため一般的ではありますが、それに対して、より良いサポートを提供することになります。

（また、）高価な（データ移行を行う）rebalance操作を行うことなく、容量の追加を行うための、より良いサポートとなります。

スコープ
--------

これにより、現状のrebalanceのコード全体、CLI, glusterd, DHTそして恐らく他に対しても、変更が発生します。

