<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="kt.log" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Use your own R packages as workspace ones on Azure Synapse Analytics Apache Spark Pool - kt.log</title>
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">
<!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]-->
<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/fancybox/jquery.fancybox.min.js"></script>
<meta name="generator" content="Hexo 6.2.0"></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">kt.log</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">Articles</a></li><li class="head-nav__item"><a class="head-nav__link" href="/tags">Tags</a></li><li class="head-nav__item"><a class="head-nav__link" href="/links">Links</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2022-12-15T14:29:31.000Z">2022-12-15 23:29:31</time><h1 class="post__title"><a href="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/">Use your own R packages as workspace ones on Azure Synapse Analytics Apache Spark Pool</a></h1><div class="post__main echo"><h1 id="自前の-R-パッケージを-Azure-Synapse-Analytics-Apache-Spark-プール-のワークスペースパッケージとして使用する"><a href="#自前の-R-パッケージを-Azure-Synapse-Analytics-Apache-Spark-プール-のワークスペースパッケージとして使用する" class="headerlink" title="自前の R パッケージを Azure Synapse Analytics Apache Spark プール のワークスペースパッケージとして使用する"></a>自前の R パッケージを Azure Synapse Analytics Apache Spark プール のワークスペースパッケージとして使用する</h1><p>本記事執筆時点ではパブリックプレビューですが、 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/azure/synapse-analytics/">Azure Synapse Analytics</a> の <a target="_blank" rel="noopener" href="https://learn.microsoft.com/azure/synapse-analytics/spark/apache-spark-pool-configurations">Apache Spark プール</a> では Python (PySpark), Scala, C# (.NET Spark), SQL だけでなく、<a target="_blank" rel="noopener" href="https://www.r-project.org/">R言語</a> (<a target="_blank" rel="noopener" href="https://spark.apache.org/docs/latest/sparkr.html">SparkR</a>) も使用することができます。Apache Spark のバージョンとしては 3 以上で利用でき、本記事執筆時点で利用可能なバージョンは 3.1, 3.2, 3.3 (プレビュー) の 3 種類です。</p>
<p>Apache Spark プールで R のパッケージを利用する方法は 2 通りです。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/azure/synapse-analytics/spark/apache-spark-manage-session-packages">ノートブック セッション パッケージ</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/azure/synapse-analytics/spark/apache-spark-manage-workspace-packages">ワークスペース パッケージ</a></li>
</ol>
<p>前者の方が一時的なもので、後者の方が恒久的なものです。</p>
<p>なお、Python の場合は上記以外に <a target="_blank" rel="noopener" href="https://learn.microsoft.com/azure/synapse-analytics/spark/apache-spark-manage-pool-packages">Spark プール パッケージ</a> という方法もあり、上記の中だと中間に位置します。</p>
<p>ノートブック セッション パッケージ の方が簡単です。ノートブックのセル内で</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;パッケージ名&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>と実行すれば、<a target="_blank" rel="noopener" href="https://cran.r-project.org/mirrors.html">CRAN</a> (Comprehensive R Archive Network) から依存関係も含めてパッケージをダウンロードし、コンパイル等してインストールしてくれます。フィーリングとしては <a target="_blank" rel="noopener" href="https://ja.wikipedia.org/wiki/Gentoo_Linux">Gentoo Linux</a> の <a target="_blank" rel="noopener" href="https://ja.wikipedia.org/wiki/Portage">Portage</a> に似ていると思います。また、上記以外にも <code>devtools</code> が利用可能です。</p>
<p>ただ、ノートブック セッション パッケージ はお手軽である反面、Spark のセッションが終了したらインストールしたパッケージも消えてしまうのがデメリットです。CRAN からのインストールの際にアーキテクチャに合ったバイナリをインストールしてくれれば早いのですが、そうではなく逐一コンパイルをするため、R パッケージのインストールには時間がかかります。</p>
<p>一方、ワークスペース パッケージ を利用すれば、Spark のセッションが終了しても、Spark クラスターにパッケージがインストールされたままとなります。こちらの方が良さそうに見えますが、デメリットとしては、依存関係が解決されないことです。</p>
<p>本記事では、前提となる環境構築手順を示した上で、R をワークスペース パッケージ として利用する際の失敗例と、問題の解決方法を示します。長くなるので、最初から解決方法を見ていただいても構いません。<br>なお、サンプルとして利用する R パッケージは <a target="_blank" rel="noopener" href="https://cran.r-project.org/web/packages/C50/index.html">C50</a> とします。</p>
<h2 id="環境構築"><a href="#環境構築" class="headerlink" title="環境構築"></a>環境構築</h2><p>Apache Spark プールにクラスターを作成します。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00001.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00002.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00003.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00004.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00005.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00006.png" class="slug">


<h2 id="失敗例"><a href="#失敗例" class="headerlink" title="失敗例"></a>失敗例</h2><p>まず、ワークスペース パッケージに C50 を登録します。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00007.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00008.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00009.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00010.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00011.png" class="slug">

<p>ワークスペース パッケージ として C50 を登録できたので、次は Apache Spark クラスターにこれをインストールするため、ワークスペース パッケージ から選択を行います。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00012.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00013.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00014.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00015.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00016.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00017.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00018.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00019.png" class="slug">

<p>ここで、インストールには時間がかかるので、気長に待ちます。</p>
<p>そして、インストールは失敗します。エラーは以下の通りです。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ProxyLivyApiAsyncError</span><br><span class="line">LibraryManagement - Spark Job for Small3NodesNoAS in workspace workshop-demo-for-ricoh in subscription ********-****-****-****-************ failed with status: </span><br><span class="line">&#123;&quot;id&quot;:2,&quot;appId&quot;:&quot;application_1671094646994_0001&quot;,&quot;appInfo&quot;:&#123;&quot;driverLogUrl&quot;:&quot;http://vm-44405081:8042/node/containerlogs/container_1671094646994_0001_01_000001/trusted-service-user&quot;,&quot;sparkUiUrl&quot;:&quot;http://vm-44405081:8088/proxy/application_1671094646994_0001/&quot;,&quot;isSessionTimedOut&quot;:null,&quot;isStreamingQueryExists&quot;:&quot;false&quot;,&quot;impulseErrorCode&quot;:&quot;Spark_Ambiguous_NonJvmUserApp_ExitWithStatus1&quot;,&quot;impulseTsg&quot;:null,&quot;impulseClassification&quot;:&quot;Ambiguous&quot;&#125;,&quot;state&quot;:&quot;dead&quot;,&quot;log&quot;:[&quot;In install.packages(\&quot;C50\&quot;, contriburl = \&quot;file://usr/lib/library-manager/bin/lmjob/Small3NodesNoAS/libraries/R/\&quot;) :&quot;,&quot;  installation of package ‘C50’ had non-zero exit status&quot;,&quot;22/12/15 08:59:39 INFO &quot;,&quot;22/12/15 08:59:39 INFO Ran Rscript -e &#x27;install.packages(\&quot;C50\&quot;, contriburl=\&quot;file://usr/lib/library-manager/bin/lmjob/Small3NodesNoAS/libraries/R/\&quot;)&#x27; successfully&quot;,&quot;22/12/15 08:59:39 INFO Running Rscript -e &#x27;library(\&quot;C50\&quot;)&#x27;&quot;,&quot;Error in library(\&quot;C50\&quot;) : there is no package called ‘C50’&quot;,&quot;Execution halted&quot;,&quot;22/12/15 08:59:40 ERROR b&#x27;&#x27;&quot;,&quot;22/12/15 08:59:40 INFO Cleanup following folders and files from staging directory:&quot;,&quot;22/12/15 08:59:40 INFO Staging directory cleaned up successfully&quot;],&quot;registeredSources&quot;:null&#125;</span><br></pre></td></tr></table></figure>

<p>ノートブックを作成し、パッケージを呼び出してみます。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00020.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00021.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00022.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00023.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00024.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00025.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00026.png" class="slug">

<p>インストールされているパッケージの一覧に C50 はありません。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00027.png" class="slug">

<p>そして、パッケージを呼び出そうとするとエラーになりました。</p>
<h2 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h2><p>パッケージの依存関係を解決します。</p>
<p>ただ、依存関係を特定した上で、当該 Apache Spark クラスターのノードにどのパッケージがインストール済みか(※)、そしてそれぞれの依存パッケージのバージョンがインストールしようとしているパッケージの要件を満たしているか、確認するのは大変です。</p>
<p>※例えば Spark 3.3 ランタイムであれば、インストール済みのパッケージのリストは <a target="_blank" rel="noopener" href="https://learn.microsoft.com/azure/synapse-analytics/spark/apache-spark-33-runtime#r-libraries-preview">こちら</a> にあります。</p>
<p>そこで、いったん ノートブック セッション パッケージ として依存関係を含めて目当てのパッケージをインストールし、そのログから ワークスペース パッケージ としてインストールする際に必要な依存パッケージを特定すると、誰でも簡単にこの問題を解決することができます。</p>
<p>その流れを以下に示します。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00028.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00029.png" class="slug">

<p><code>install.packages(&quot;C50&quot;)</code> の出力には以下のような文字列が含まれています。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">also installing the dependencies ‘libcoin’, ‘mvtnorm’, ‘Formula’, ‘inum’, ‘partykit’, ‘Cubist’</span><br><span class="line"></span><br><span class="line">trying URL &#x27;https://cloud.r-project.org/src/contrib/libcoin_1.0-9.tar.gz&#x27;</span><br><span class="line">Content type &#x27;application/x-gzip&#x27; length 992315 bytes (969 KB)</span><br><span class="line">==================================================</span><br><span class="line">downloaded 969 KB</span><br><span class="line"></span><br><span class="line">trying URL &#x27;https://cloud.r-project.org/src/contrib/mvtnorm_1.1-3.tar.gz&#x27;</span><br><span class="line">Content type &#x27;application/x-gzip&#x27; length 166421 bytes (162 KB)</span><br><span class="line">==================================================</span><br><span class="line">downloaded 162 KB</span><br><span class="line"></span><br><span class="line">trying URL &#x27;https://cloud.r-project.org/src/contrib/Formula_1.2-4.tar.gz&#x27;</span><br><span class="line">Content type &#x27;application/x-gzip&#x27; length 164214 bytes (160 KB)</span><br><span class="line">==================================================</span><br><span class="line">downloaded 160 KB</span><br><span class="line"></span><br><span class="line">trying URL &#x27;https://cloud.r-project.org/src/contrib/inum_1.0-4.tar.gz&#x27;</span><br><span class="line">Content type &#x27;application/x-gzip&#x27; length 12142 bytes (11 KB)</span><br><span class="line">==================================================</span><br><span class="line">downloaded 11 KB</span><br><span class="line"></span><br><span class="line">trying URL &#x27;https://cloud.r-project.org/src/contrib/partykit_1.2-16.tar.gz&#x27;</span><br><span class="line">Content type &#x27;application/x-gzip&#x27; length 2121360 bytes (2.0 MB)</span><br><span class="line">==================================================</span><br><span class="line">downloaded 2.0 MB</span><br><span class="line"></span><br><span class="line">trying URL &#x27;https://cloud.r-project.org/src/contrib/Cubist_0.4.1.tar.gz&#x27;</span><br><span class="line">Content type &#x27;application/x-gzip&#x27; length 1523257 bytes (1.5 MB)</span><br><span class="line">==================================================</span><br><span class="line">downloaded 1.5 MB</span><br><span class="line"></span><br><span class="line">trying URL &#x27;https://cloud.r-project.org/src/contrib/C50_0.1.7.tar.gz&#x27;</span><br><span class="line">Content type &#x27;application/x-gzip&#x27; length 304504 bytes (297 KB)</span><br><span class="line">==================================================</span><br><span class="line">downloaded 297 KB</span><br><span class="line"></span><br><span class="line">Loading required package: usethis</span><br><span class="line">* installing *source* package ‘mvtnorm’ ...</span><br><span class="line">** package ‘mvtnorm’ successfully unpacked and MD5 sums checked</span><br><span class="line">** using staged installation</span><br></pre></td></tr></table></figure>

<p>そして、出力は</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* DONE (C50)</span><br><span class="line"></span><br><span class="line">The downloaded source packages are in</span><br><span class="line">	‘/tmp/RtmplbLWPy/downloaded_packages’</span><br><span class="line">[notebook] install.packages pkgs=C50 cost [101s] time:2022-12-15 16:08:45</span><br></pre></td></tr></table></figure>

<p>という形でエラー無く <code>DONE</code> となっており、<code>library()</code> の結果に <code>C50</code> は含まれていますし、</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00030.png" class="slug">

<p><code>library(C50)</code> でパッケージの読み込みもできます。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00031.png" class="slug">


<p>ワークスペース パッケージ としてパッケージをインストールする際に同時に必要となる依存パッケージは、上記の出力に含まれる <code>.tar.gz</code> の URI から <code>wget</code> 等でダウンロードしてくれば良いのです。</p>
<p>そして、Apache Spark プールのクラスターに、ワークスペース パッケージ からインストールを行います。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00032.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00033.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00034.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00035.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00036.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00037.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00038.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00039.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00040.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00041.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00042.png" class="slug">

<p>インストールに成功しました。それでは、ワークスペース パッケージ からインストールしたパッケージを、ノートブックから呼び出してみましょう。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00043.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00044.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00045.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00046.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00047.png" class="slug">

<p>成功です。</p>
<p>最後に、セッションを一度終了しても、ワークスペース パッケージ としてインストールされたパッケージが再度利用できることを確認しておきましょう。</p>
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00048.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00049.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00050.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00051.png" class="slug">
<img src="/2022/12/15/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool/Use-your-own-R-packages-as-workspace-ones-on-Azure-Synapse-Analytics-Apache-Spark-Pool-00052.png" class="slug">

<p>問題ありません。これで、Apache Spark クラスターとのセッション状態とは関係無く、R パッケージを恒久的に利用できるようになりました。</p>
<h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/azure/synapse-analytics/">Azure Synapse Analytics</a> の <a target="_blank" rel="noopener" href="https://learn.microsoft.com/azure/synapse-analytics/spark/apache-spark-pool-configurations">Apache Spark プール</a> で R言語を利用する場合、かつ自前のパッケージをインストールしたり ワークスペース パッケージ を利用する場合に、自分で依存関係を解決する方法を解説しました。</p>
<p>少し回り道にはなりますが、一度 ノートブック セッション パッケージ として CRAN 等を使ってインストールすることで、依存パッケージをバージョンや URI も含めて特定することができ、誰でも簡単に R パッケージのインストールを恒久化することができます。</p>
<p>Azure Synapse Analytics 上で R によるデータ分析をゴリゴリやる方には必須知識だと思いますので、ぜひお役立てください。</p>
<h2 id="See-also"><a href="#See-also" class="headerlink" title="See also"></a>See also</h2><ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/ja-jp/azure/architecture/data-guide/technology-choices/r-developers-guide">R 開発者向けガイド - R プログラミング - Azure Architecture Center | Microsoft Learn</a></li>
</ul>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/Azure/">Azure</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/Azure-Synapse-Analytics/">Azure Synapse Analytics</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/Apache-Spark/">Apache Spark</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/R/">R</a></li></ul></footer></article></main><footer class="foot"><div class="foot-copy">&copy; 2021 - 2022 kt.log<a class="icp-a" href="https://github.com/k14i" target="view_window">by kt (Keisuke Takahashi)</a></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','G-9XBBR7M7V2');
ga('send','pageview');</script>
<script src="/js/scroller.js"></script>

<script src="/js/main.js"></script>
</body></html>